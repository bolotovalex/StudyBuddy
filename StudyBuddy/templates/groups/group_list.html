{% extends 'base.html' %}

{% block title %}Список групп{% endblock %}
{% block page_title %}Список групп{% endblock %}

{% block content %}
<div class="w-full max-w-2xl mx-auto">
    <form method="get" action="{% url 'groups:group_list' %}" class="flex flex-col sm:flex-row gap-2 mb-6">
        <input type="text" name="q" value="{{ query }}" placeholder="Введите название группы"
               class="input input-bordered w-full sm:w-auto flex-grow" />
        <button type="submit" class="btn btn-primary">Поиск</button>
        {% if query %}
        <a href="{% url 'groups:group_list' %}" class="btn btn-outline btn-secondary">Сброс</a>
        {% endif %}
    </form>

    <div class="space-y-4">
        {% for group in groups %}
            <div class="card bg-base-100 shadow-sm">
                <div class="card-body flex flex-row items-center justify-between p-4">
                    <div>
                        <h2 class="card-title mb-1 text-lg font-semibold">{{ group.name }}</h2>
                        <p class="text-base-content/70 text-sm">{{ group.description }}</p>
                    </div>
                    <div class="flex flex-col items-end gap-2 min-w-[120px]">
                        {% if user in group.members.all %}
                            <a href="{% url 'groups:group_detail' group.pk %}" class="btn btn-primary btn-sm w-full">Войти</a>
                        {% elif user in group.access_requests.all %}
                            <span class="badge badge-warning text-xs">Доступ запрошен</span>
                        {% else %}
                            <a href="{% url 'groups:request_access' group.pk %}" class="btn btn-outline btn-primary btn-sm w-full">Запросить доступ</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% empty %}
            <div class="text-center text-base-content/60 py-8">Группы не найдены</div>
        {% endfor %}
    </div>

    <div class="flex justify-center mt-8">
        <a href="{% url 'groups:create_group' %}" class="btn btn-success btn-lg w-full max-w-xs">
            Создать новую группу
        </a>
    </div>
</div>
{% endblock %}
